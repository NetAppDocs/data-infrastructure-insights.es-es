---
sidebar: sidebar 
permalink: troubleshooting_collector_svm.html 
keywords: data collector, ONTAP, NetApp, SVM, cloud ontap, firewall 
summary: Solución de problemas de los recopiladores de datos de seguridad de la carga de trabajo 
---
= Solución de problemas del recopilador de datos ONTAP SVM
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Workload Security utiliza recopiladores de datos para recopilar datos de acceso a archivos y usuarios de los dispositivos.  Aquí puede encontrar sugerencias para solucionar problemas con este recopilador.

Ver ellink:task_add_collector_svm.html["Configuración del recopilador SVM"] página para obtener instrucciones sobre cómo configurar este recopilador.

En caso de error, puede hacer clic en _más detalles_ en la columna _Estado_ de la página Recopiladores de datos instalados para obtener detalles sobre el error.

image:CS_Data_Collector_Error.png["Enlace para obtener más detalles sobre el error del recopilador de seguridad de carga de trabajo"]

A continuación se describen los problemas conocidos y sus soluciones.

****
*Problema:* El recopilador de datos se ejecuta durante un tiempo y se detiene después de un tiempo aleatorio, y falla con: "Mensaje de error: el conector está en estado de error".  Nombre del servicio: auditoría.  Motivo del fallo: Servidor fpolicy externo sobrecargado.

*Pruebe esto:* La tasa de eventos de ONTAP fue mucho más alta que lo que el cuadro del Agente puede manejar.  Por lo tanto, la conexión se terminó.

Verifique el tráfico máximo en CloudSecure cuando ocurrió la desconexión.  Puedes comprobarlo en la página *CloudSecure > Análisis forense de actividad > Toda la actividad*.

Si el tráfico agregado máximo es más alto que lo que el Agent Box puede manejar, consulte la página del Comprobador de tasa de eventos para obtener información sobre cómo dimensionar la implementación del recopilador en un Agent Box.

Si el Agente se instaló en el cuadro del Agente antes del 4 de marzo de 2021, ejecute los siguientes comandos en el cuadro del Agente:

....
echo 'net.core.rmem_max=8388608' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_rmem = 4096 2097152 8388608' >> /etc/sysctl.conf
sysctl -p
....
Reinicie el recopilador desde la interfaz de usuario después de cambiar el tamaño.

****
****
*Problema:* El recopilador informa el mensaje de error: “No se encontró ninguna dirección IP local en el conector que pueda acceder a las interfaces de datos del SVM”.  *Pruebe esto:* Lo más probable es que esto se deba a un problema de red en el lado de ONTAP .  Por favor siga estos pasos:

. Asegúrese de que no haya firewalls en el servidor de datos SVM ni en el servidor de administración SVM que bloqueen la conexión desde el SVM.
. Al agregar una SVM a través de una IP de administración de clúster, asegúrese de que la vida de los datos y la vida de administración de la SVM se puedan hacer ping desde la VM del agente.  En caso de problemas, verifique la puerta de enlace, la máscara de red y las rutas para el LIF.
+
También puede intentar iniciar sesión en el clúster a través de ssh usando la IP de administración del clúster y hacer ping a la IP del agente.  Asegúrese de que la IP del agente se pueda ping:

+
 network ping -vserver <vserver name> -destination <Agent IP> -lif <Lif Name> -show-detail
+
Si no se puede hacer ping, asegúrese de que la configuración de red en ONTAP sea correcta, para que se pueda hacer ping a la máquina del Agente.

. Si ha intentado conectarse a través de la IP del clúster y no funciona, intente conectarse directamente a través de la IP de SVM.  Consulte más arriba los pasos para conectarse a través de IP SVM.
. Al agregar el recopilador a través de la IP de SVM y las credenciales de vsadmin, verifique si SVM Lif tiene habilitada la función Datos más administración.  En este caso, hacer ping al SVM Lif funcionará, sin embargo, SSH al SVM Lif no funcionará.  En caso afirmativo, cree un Lif de solo administración de SVM e intente conectarse a través de este Lif de solo administración de SVM.
. Si aún no funciona, cree un nuevo SVM Lif e intente conectarse a través de ese Lif.  Asegúrese de que la máscara de subred esté configurada correctamente.
. Depuración avanzada:
+
.. Iniciar un seguimiento de paquetes en ONTAP.
.. Intente conectar un recopilador de datos al SVM desde la interfaz de usuario de CloudSecure.
.. Espere hasta que aparezca el error.  Detener el seguimiento de paquetes en ONTAP.
.. Abra el seguimiento de paquetes desde ONTAP.  Está disponible en esta ubicación.
+
 https://<cluster_mgmt_ip>/spi/<clustername>/etc/log/packet_traces/
.. Asegúrese de que haya un SYN de ONTAP al cuadro del Agente.
.. Si no hay SYN de ONTAP , entonces es un problema con el firewall en ONTAP.
.. Abra el firewall en ONTAP, para que ONTAP pueda conectarse al cuadro del agente.


. Si aún no funciona, consulte al equipo de redes para asegurarse de que ningún firewall externo esté bloqueando la conexión de ONTAP al cuadro del Agente.
. Si nada de lo anterior resuelve el problema, abra un caso conlink:concept_requesting_support.html["Soporte de Netapp"] Para obtener más ayuda.


****
****
*Problema:* Mensaje: "No se pudo determinar el tipo de ONTAP para [nombre de host: <Dirección IP>.  Motivo: Error de conexión al sistema de almacenamiento <Dirección IP>: El host no es accesible (Host inaccesible)" *Pruebe esto:*

. Verifique que se haya proporcionado la dirección IP de administración de SVM o la IP de administración de clúster correcta.
. Conéctese por SSH al SVM o al clúster al que desea conectarse.  Una vez conectado, asegúrese de que el nombre de SVM o del clúster sea correcto.


****
****
*Problema:* Mensaje de error: "El conector está en estado de error.  Servicio.nombre:auditoría.  Motivo del fallo: "Servidor fpolicy externo finalizado".  *Prueba esto:*

. Lo más probable es que un firewall esté bloqueando los puertos necesarios en la máquina del agente.  Verifique que el rango de puertos 35000-55000/tcp esté abierto para que la máquina agente se conecte desde la SVM.  Asegúrese también de que no haya ningún firewall habilitado desde el lado de ONTAP que bloquee la comunicación con la máquina del agente.
. Escriba el siguiente comando en el cuadro Agente y asegúrese de que el rango de puertos esté abierto.
+
 sudo iptables-save | grep 3500*
+
El resultado de muestra debería verse así:

+
 -A IN_public_allow -p tcp -m tcp --dport 35000 -m conntrack -ctstate NEW -j ACCEPT
. Inicie sesión en SVM, ingrese los siguientes comandos y verifique que no haya ningún firewall configurado para bloquear la comunicación con ONTAP.
+
....
system services firewall show
system services firewall policy show
....
+
link:https://docs.netapp.com/ontap-9/index.jsp?topic=%2Fcom.netapp.doc.dot-cm-nmg%2FGUID-969851BB-4302-4645-8DAC-1B059D81C5B2.html["Comprobar los comandos del firewall"]en el lado de ONTAP .

. Conéctese mediante SSH al SVM/Cluster que desea monitorear.  Haga ping al cuadro del agente desde la base de datos SVM (con soporte para protocolos CIFS y NFS) y asegúrese de que el ping funcione:
+
 network ping -vserver <vserver name> -destination <Agent IP> -lif <Lif Name> -show-detail
+
Si no se puede hacer ping, asegúrese de que la configuración de red en ONTAP sea correcta, para que se pueda hacer ping a la máquina del Agente.

. Si se agrega un solo SVM dos veces a un inquilino a través de 2 recopiladores de datos, se mostrará este error.  Eliminar uno de los recopiladores de datos a través de la interfaz de usuario.  Luego reinicie el otro recopilador de datos a través de la interfaz de usuario.  Luego, el recopilador de datos mostrará el estado “EN EJECUCIÓN” y comenzará a recibir eventos de SVM.
+
Básicamente, en un inquilino, 1 SVM debe agregarse solo una vez, a través de 1 recopilador de datos.  1 SVM no debe agregarse dos veces a través de 2 recopiladores de datos.

. En los casos en que se agregó el mismo SVM en dos entornos de seguridad de carga de trabajo diferentes (inquilinos), el último siempre tendrá éxito.  El segundo recopilador configurará fpolicy con su propia dirección IP y expulsará al primero.  Por lo tanto, el recopilador del primero dejará de recibir eventos y su servicio de "auditoría" entrará en estado de error.  Para evitar esto, configure cada SVM en un solo entorno.
. Este error también puede ocurrir si las políticas de servicio no están configuradas correctamente.  Con ONTAP 9.8 o posterior, para conectarse al recopilador de fuentes de datos, se requiere el servicio data-fpolicy-client junto con el servicio de datos data-nfs y/o data-cifs.  Además, el servicio data-fpolicy-client debe estar asociado con los datos lif para el SVM monitoreado.


****
****
*Problema:* No se ven eventos en la página de actividad.  *Prueba esto:*

. Compruebe si el recopilador ONTAP está en estado “EN EJECUCIÓN”.  Si es así, asegúrese de que se generen algunos eventos CIF en las máquinas virtuales del cliente CIF abriendo algunos archivos.
. Si no se ven actividades, inicie sesión en SVM e ingrese el siguiente comando.
+
 <SVM>event log show -source fpolicy
+
Asegúrese de que no haya errores relacionados con fpolicy.

. Si no se ven actividades, inicie sesión en SVM. Introduzca el siguiente comando:
+
 <SVM>fpolicy show
+
Verifique si la política fpolicy denominada con el prefijo “cloudsecure_” se ha configurado y el estado es “activado”.  Si no se configura, lo más probable es que el agente no pueda ejecutar los comandos en la SVM.  Asegúrese de que se hayan cumplido todos los requisitos previos descritos al principio de la página.



****
****
*Problema:* El recopilador de datos SVM está en estado de error y el mensaje de error es “El agente no pudo conectarse al recopilador”. *Pruebe esto:*

. Lo más probable es que el agente esté sobrecargado y no pueda conectarse a los recopiladores de fuentes de datos.
. Verifique cuántos recopiladores de fuentes de datos están conectados al agente.
. Verifique también la velocidad del flujo de datos en la página “Toda la actividad” de la interfaz de usuario.
. Si la cantidad de actividades por segundo es significativamente alta, instale otro Agente y mueva algunos de los Recopiladores de fuentes de datos al nuevo Agente.


****
****
*Problema:* El recopilador de datos de SVM muestra un mensaje de error como "fpolicy.server.connectError: el nodo no pudo establecer una conexión con el servidor FPolicy "12.195.15.146" (motivo: "Se agotó el tiempo de selección")" *Pruebe esto:* El firewall está habilitado en SVM/Cluster.  Entonces, el motor fpolicy no puede conectarse al servidor fpolicy.  Las CLI en ONTAP que se pueden utilizar para obtener más información son:

....
event log show -source fpolicy which shows the error
event log show -source fpolicy -fields event,action,description which shows more details.
....
link:https://docs.netapp.com/ontap-9/index.jsp?topic=%2Fcom.netapp.doc.dot-cm-nmg%2FGUID-969851BB-4302-4645-8DAC-1B059D81C5B2.html["Comprobar los comandos del firewall"]en el lado de ONTAP .

****
****
*Problema:* Mensaje de error: “El conector está en estado de error.  Nombre del servicio:auditoría.  Motivo del error: No se encontró ninguna interfaz de datos válida (función: datos, protocolos de datos: NFS o CIFS o ambos, estado: activo) en la SVM.  *Pruebe esto:* Asegúrese de que haya una interfaz operativa (que tenga función de datos y protocolo de datos como CIFS/NFS).

****
****
*Problema:* El recopilador de datos entra en estado de Error y luego pasa al estado EN EJECUCIÓN después de un tiempo, para luego volver al estado de Error nuevamente.  Este ciclo se repite.  *Pruebe esto:* Esto suele suceder en el siguiente escenario:

. Se agregaron varios recopiladores de datos.
. A los recopiladores de datos que muestren este tipo de comportamiento se les agregará 1 SVM.  Lo que significa que 2 o más recopiladores de datos están conectados a 1 SVM.
. Asegúrese de que un recopilador de datos se conecte a solo una SVM.
. Eliminar los demás recopiladores de datos que estén conectados al mismo SVM.


****
****
*Problema:* El conector está en estado de error.  Nombre del servicio: auditoría.  Motivo del error: No se pudo configurar (política en SVM svmname.  Motivo: Valor no válido especificado para el elemento 'shares-to-include' dentro de 'fpolicy.policy.scope-modify: "Federal'' *Pruebe esto:* *Los nombres de los recursos compartidos deben proporcionarse sin comillas.  Edite la configuración de DSC de ONTAP SVM para corregir los nombres de los recursos compartidos.

_Incluir y excluir acciones_ no está pensado para una lista larga de nombres de acciones.  Utilice el filtrado por volumen en su lugar si tiene una gran cantidad de acciones para incluir o excluir.

****
****
*Problema:* Existen políticas fpolicies en el Cluster que no se utilizan.  ¿Qué se debe hacer con ellos antes de instalar Workload Security?  *Pruebe esto:* Se recomienda eliminar todas las configuraciones fpolicy existentes no utilizadas incluso si están en estado desconectado.  Workload Security creará fpolicy con el prefijo "cloudsecure_".  Se pueden eliminar todas las demás configuraciones de fpolicy no utilizadas.

Comando CLI para mostrar la lista fpolicy:

 fpolicy show
Pasos para eliminar configuraciones de fpolicy:

....
fpolicy disable -vserver <svmname> -policy-name <policy_name>
fpolicy policy scope delete -vserver <svmname> -policy-name <policy_name>
fpolicy policy delete -vserver <svmname> -policy-name <policy_name>
fpolicy policy event delete -vserver <svmname> -event-name <event_list>
fpolicy policy external-engine delete -vserver <svmname> -engine-name <engine_name>
....
|Después de habilitar la seguridad de la carga de trabajo, el rendimiento de ONTAP se ve afectado: la latencia se vuelve esporádicamente alta, las IOP se vuelven esporádicamente bajas.  |Al usar ONTAP con Workload Security, a veces se pueden observar problemas de latencia en ONTAP.  Hay varias razones posibles para esto, como se señala a continuación:link:https://mysupport.netapp.com/site/bugs-online/product/ONTAP/BURT/1372994["1372994"] , https://mysupport.netapp.com/site/bugs-online/product/ONTAP/BURT/1415152["1415152"] , https://mysupport.netapp.com/site/bugs-online/product/ONTAP/BURT/1438207["1438207"] , https://mysupport.netapp.com/site/bugs-online/product/ONTAP/BURT/1479704["1479704"] , https://mysupport.netapp.com/site/bugs-online/product/ONTAP/BURT/1354659["1354659"] .  Todos estos problemas están solucionados en ONTAP 9.13.1 y versiones posteriores; se recomienda encarecidamente utilizar una de estas versiones posteriores.

****
****
*Problema:* El recopilador de datos tiene un error y muestra este mensaje de error.  “Error: el conector está en estado de error.  Nombre del servicio: auditoría.  Motivo del error: No se pudo configurar la política en SVM svm_test.  Motivo: Falta valor para el campo zapi: eventos.  “ *Prueba esto:*

. Comience con una nueva SVM con solo el servicio NFS configurado.
. Agregue un recopilador de datos ONTAP SVM en Seguridad de carga de trabajo.  CIFS se configura como un protocolo permitido para SVM al agregar el recopilador de datos ONTAP SVM en Seguridad de carga de trabajo.
. Espere hasta que el recopilador de datos en Seguridad de carga de trabajo muestre un error.
. Dado que el servidor CIFS NO está configurado en el SVM, este error, como se muestra a la izquierda, lo muestra Workload Security.
. Edite el recopilador de datos ONTAP SVM y desmarque los CIF como protocolo permitido.  Guarde el recopilador de datos.  Comenzará a ejecutarse solo con el protocolo NFS habilitado.


****
****
*Problema:* El recopilador de datos muestra el mensaje de error: “Error: No se pudo determinar el estado del recopilador en 2 reintentos, intente reiniciar el recopilador nuevamente (Código de error: AGENT008)”.  *Prueba esto:*

. En la página Recopiladores de datos, desplácese hacia la derecha del recopilador de datos que genera el error y haga clic en el menú de 3 puntos.  Seleccione _Editar_.  Introduzca nuevamente la contraseña del recopilador de datos.  Guarde el recopilador de datos presionando el botón _Guardar_.  El recopilador de datos se reiniciará y el error debería resolverse.
. Es posible que la máquina del agente no tenga suficiente espacio en CPU o RAM; es por eso que los DSC están fallando.  Verifique la cantidad de recopiladores de datos que se agregaron al agente en la máquina.  Si es más de 20, aumente la capacidad de CPU y RAM de la máquina del Agente.  Una vez que se aumenta la CPU y la RAM, los DSC pasarán al estado de inicialización y luego al estado de ejecución automáticamente.  Consulta la guía de tallas enlink:concept_cs_event_rate_checker.html["esta página"] .


****
****
*Problema:* El recopilador de datos genera un error cuando se selecciona el modo SVM.  *Pruebe esto:* Al conectarse en modo SVM, si se utiliza la IP de administración del clúster para conectarse en lugar de la IP de administración de SVM, la conexión generará un error.  Asegúrese de que se utilice la IP SVM correcta.

****
****
*Problema:* El recopilador de datos muestra un mensaje de error cuando la función Acceso denegado está habilitada: "El conector está en estado de error.  Nombre del servicio: auditoría.  Motivo del error: No se pudo configurar fpolicy en SVM test_svm.  Motivo: El usuario no está autorizado."  *Pruebe esto:* Es posible que al usuario le falten los permisos REST necesarios para la función Acceso denegado.  Por favor, siga las instrucciones enlink:concept_ws_integration_with_ontap_access_denied.html["esta página"] para establecer los permisos.

Reinicie el recopilador una vez establecidos los permisos.

****
Si aún tiene problemas, comuníquese con los enlaces de soporte mencionados en la página *Ayuda > Soporte*.

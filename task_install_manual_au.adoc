---
sidebar: sidebar 
permalink: task_install_manual_au.html 
keywords: Acquisition Unit, AU, install, configure, Linux, add, remove, uninstall, delete, deleting, move, moving, manual, AU, Patch 
summary: Data Infrastructure Insights se puede configurar para que el software de AU se actualice manualmente, lo que proporciona más control sobre el software instalado en su inquilino. 
---
= Instalación manual del software de la unidad de adquisición
:hardbreaks:
:allow-uri-read: 


[role="lead"]
De forma predeterminada, Data Infrastructure Insights actualiza el software de la Unidad de adquisición (AU) automáticamente a medida que se implementan las actualizaciones.  Sin embargo, en entornos controlados y seguros, la actualización automática puede no ser posible o deseada.  En estos casos, Data Infrastructure Insights se puede configurar para que el software de AU se actualice manualmente, lo que proporciona más control sobre el software instalado en su inquilino.

Para descargar e instalar manualmente el software AU, realice los siguientes pasos.  Data Infrastructure Insights proporciona una página de documentación de Swagger útil que puede utilizar para muchos de estos pasos, o puede utilizar su propio script/comandos de API.  Vaya a Admin > Acceso API y haga clic en el enlace “Documentación API”.

El proceso es similar para Linux y Windows.



== Realizar una NUEVA instalación de AU en Linux:

. En Data Infrastructure Insights, cree un token de API.
+
.. Vaya a *Admin > Acceso API* y seleccione *+Token de acceso API*.
+
... Establezca un *Nombre* y una *Descripción* que sean fáciles de identificar
... Tipo: Elija *Unidad de adquisición* y *Recopilación de datos*
... Permisos: *Lectura/Escritura*
... Seleccione los valores de *Caducidad* y *Renovación automática* deseados


.. Haga clic en *Guardar*
.. Copie el token de acceso API generado.  Este paso debe realizarse antes de poder cerrar la ventana.




image:Manual_AU_Create_API_Token.png["Crear token de API"]

. En Swagger (Administrador > Acceso a la API > Documentación de la API), use el token para autorizar las API de Data Infrastructure Insights
+
.. Haga clic en _Autorizar_ en la parte superior derecha de la pantalla Swagger
.. Pegue el token copiado arriba en el campo Clave API del cliente
.. Haga clic en *Autorizar*
.. Cerrar la ventana




image:Manual_AU_Authorization.png["Autorizar el token API"]

. Descargue el instalador de AU utilizando la API _/au/installers/{platform}/latest_ o _/au/installers/{platform}/{version}_:
+
.. Plataforma: *linux*
.. Versión: *<versión>* (última o especificada)




image:Manual_AU_API_Retrieve_latest.png["API para recuperar la última versión de AU"]


NOTE: Si no está descargando la última versión, confirme con NetApp la versión AU que se especificará para la descarga.

. Haga clic en *Descargar archivo*.  Si está realizando estos pasos en un sistema distinto del sistema AU, copie el archivo descargado al sistema AU.
. Alternativamente, puede ejecutar el comando CURL resultante en el sistema AU:
+
 curl -X GET "<tenant>/rest/v1/au/installers/linux/<AU version>" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <token>"
. En este punto, el archivo de instalación debería estar presente en el sistema AU.



IMPORTANT: Los siguientes pasos requieren el uso de un token temporal.  No utilice el token de acceso API que creó anteriormente.

. En la API Swagger de Data Infrastructure Insights , cree un token de un solo uso utilizando la API _/au/oneTimeToken_.
+
.. Copia el token de un solo uso resultante.




image:Manual_AU_one_time_token.png["Crear un token API de un solo uso"] image:Manual_AU_one_time_token_response.png["Ejemplo de respuesta para un token de API de un solo uso"]

. En la máquina donde se instalará el AU, navegue hasta la carpeta que contiene el archivo de instalación descargado.  Los siguientes comandos requieren que el usuario tenga permisos de root.
+
.. Descomprima el archivo de instalación
.. Cambie el directorio a la carpeta de instalación resultante
.. Exporte el token de un solo uso y la versión del instalador a las variables de entorno ejecutando lo siguiente:
+
 export TOKEN=<One-Time Token>
.. Ejecute lo siguiente para instalar CI con un usuario y grupo personalizados:
+
 ./cloudinsights-install.sh <custom user> <custom group>
+
Nota: Si no desea utilizar un usuario y grupo personalizados, puede utilizar el usuario y grupo predeterminados “cisys”.  En este caso, ejecute el comando de instalación anterior pero no especifique el usuario ni el grupo.





En este punto, el software AU está instalado en el sistema y el usuario y grupo personalizados pueden acceder a él.  Sin embargo, no tienes la posibilidad de agregar recopiladores de datos.  Para hacer esto manualmente, lea las siguientes instrucciones.  Si solo desea instalar un parche, consulte la<<downloading-a-patch,Parche>> sección a continuación.



== Instalación manual de recopiladores de datos

Descargue la última versión de datasources.war utilizando la API /collector/patch/datasourceswar/latest:

image:API_Manual_Download_datasources.png["API para recuperar las últimas fuentes de datos.war"]

Nota: Si no está descargando la última versión, confirme con NetApp la versión que se especificará para la descarga.

Haga clic en Descargar archivo.  Si está realizando estos pasos en un sistema distinto del sistema AU, copie el paquete zip datasources.war descargado al sistema AU.

Asegúrese de que el paquete zip datasources.war se copie en el siguiente directorio: /var/lib/netapp/cloudinsights/acq/download

Navegue al directorio /var/lib/netapp/cloudinsights/acq/download para datasources.war y verifique el archivo zip allí:

. Debe cambiar a (o cerrar sesión como root e iniciar sesión con) el usuario personalizado para los siguientes pasos.
+
 su <custom user>
+
Nota: Si está utilizando el usuario y grupo “cisys” predeterminados, no necesita realizar este paso.

+
Nota: El usuario personalizado puede ser cualquier usuario que sea miembro de un grupo personalizado que haya proporcionado a cloudinsights-install.sh durante la instalación de AU, y puede ser el mismo o diferente del usuario personalizado que haya proporcionado durante la instalación de AU.

. Realice lo siguiente:
+
....
chmod 770 /var/lib/netapp/cloudinsights/acq/download/datasources-war-<version>.zip
ls -al /var/lib/netapp/cloudinsights/acq/download
…
drwxrwx--- 2 test-user2 test-group-1  4096 Feb 16 10:10 datasources-war-<version>.zip
…
....
+
Nota: Si utiliza el usuario y grupo “cisys”, estos se mostrarán en el resultado anterior.

+
Nota: Si planea realizar la instalación utilizando diferentes usuarios personalizados, asegúrese de que los permisos de grupo estén configurados para leer y escribir tanto para el propietario como para el grupo (chmod 660…)

. Reiniciar la AU.  En Data Infrastructure Insights, navegue a Observabilidad > Recopiladores y seleccione la pestaña Unidades de adquisición.  Seleccione Reiniciar en el menú de “tres puntos” a la derecha de la AU.




== Descargar un parche

Descargue el parche usando la API /collector/patch/file/{version}:

image:API_Manual_Download_patch.png["API para recuperar parche"]

Nota: confirme con NetApp la versión que se especificará para la descarga.

Haga clic en Descargar archivo.  Si está realizando estos pasos en un sistema distinto del sistema AU, copie el paquete zip del parche descargado al sistema AU.

Asegúrese de que el paquete zip del parche se copie en el siguiente directorio: /var/lib/netapp/cloudinsights/acq/download

Navegue al directorio /var/lib/netapp/cloudinsights/acq/download para el parche y verifique el archivo .zip allí:

. Debe cambiar a (o cerrar sesión como root e iniciar sesión con) el usuario personalizado para los siguientes pasos.
+
 su <custom user>
+
Nota: Si está utilizando el usuario y grupo “cisys” predeterminados, no necesita realizar este paso.

+
Nota: El usuario personalizado puede ser cualquier usuario que sea miembro de un grupo personalizado que haya proporcionado a cloudinsights-install.sh durante la instalación de AU, y puede ser el mismo o diferente del usuario personalizado que haya proporcionado durante la instalación de AU.

. Realice lo siguiente:
+
....
chmod 770 /var/lib/netapp/cloudinsights/acq/download/<patch_file_name>.zip
ls -al /var/lib/netapp/cloudinsights/acq/download
…
drwxrwx--- 2 test-user2 test-group-1  4096 Feb 16 10:10 <patch_file_name>.zip
…
....
+
Nota: Si utiliza el usuario y grupo “cisys”, estos se mostrarán en el resultado anterior.

+
Nota: Si planea realizar la instalación utilizando diferentes usuarios personalizados, asegúrese de que los permisos de grupo estén configurados para leer y escribir tanto para el propietario como para el grupo (chmod 660…)

. Reiniciar la AU.  En Data Infrastructure Insights, navegue a Observabilidad > Recopiladores y seleccione la pestaña Unidades de adquisición.  Seleccione Reiniciar en el menú de “tres puntos” a la derecha de la AU.




== Recuperación de clave externa

Si proporciona un script de shell de UNIX, la unidad de adquisición puede ejecutarlo para recuperar la *clave privada* y la *clave pública* de su sistema de administración de claves.

Para recuperar la clave, Data Infrastructure Insights ejecutará el script, pasando dos parámetros: _key id_ y _key type_.  _Key id_ se puede utilizar para identificar la clave en su sistema de gestión de claves.  El tipo de clave es "pública" o "privada".  Cuando el tipo de clave es "pública", el script debe devolver la clave pública.  Cuando el tipo de clave es "privada", se debe devolver la clave privada.

Para enviar la clave de vuelta a la unidad de adquisición, el script debe imprimir la clave en la salida estándar.  El script debe imprimir _sólo_ la clave en la salida estándar; no se debe imprimir ningún otro texto en la salida estándar.  Una vez que la clave solicitada se imprime en la salida estándar, el script debe salir con un código de salida de 0; cualquier otro código de retorno se considera un error.

El script debe registrarse en la unidad de adquisición mediante la herramienta SecurityAdmin, que ejecutará el script junto con la unidad de adquisición.  El script debe tener permisos de _lectura_ y _ejecución_ para el usuario root y "cisys".  Si el script de shell se modifica después del registro, el script de shell modificado debe volver a registrarse en la unidad de adquisición.

|===


| parámetro de entrada: id de clave | Identificador de clave utilizado para identificar la clave en el sistema de gestión de claves del cliente. 


| parámetro de entrada: tipo de clave | público o privado. 


| producción | La clave solicitada debe imprimirse en la salida estándar.  Actualmente se admite una clave RSA de 2048 bits.  Las claves deben codificarse e imprimirse en el siguiente formato: formato de clave privada: PEM, codificado en DER PKCS8 PrivateKeyInfo RFC 5958 formato de clave pública: PEM, codificado en DER X.509 SubjectPublicKeyInfo RFC 5280 


| código de salida | Código de salida de cero para el éxito.  Todos los demás valores de salida se consideran un fracaso. 


| permisos de script | El script debe tener permisos de lectura y ejecución para el usuario root y "cisys". 


| registros | Las ejecuciones de scripts se registran.  Los registros se pueden encontrar en: /var/log/netapp/cloudinsights/securityadmin/securityadmin.log /var/log/netapp/cloudinsights/acq/acq.log 
|===